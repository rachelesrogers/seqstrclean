<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>larger_notecleaning • seqstrclean</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="larger_notecleaning">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">seqstrclean</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/larger_notecleaning.html">larger_notecleaning</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rachelesrogers/seqstrclean/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>larger_notecleaning</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rachelesrogers/seqstrclean/blob/master/vignettes/articles/larger_notecleaning.Rmd" class="external-link"><code>vignettes/articles/larger_notecleaning.Rmd</code></a></small>
      <div class="d-none name"><code>larger_notecleaning.Rmd</code></div>
    </div>

    
    
<p>This article focuses on note cleaning for a larger data set. While
time-consuming, this code demonstrates the full application of this
package, with a workable example of hybrid note cleaning.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rachelesrogers/seqstrclean" class="external-link">seqstrclean</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="hybrid-method">Hybrid Method<a class="anchor" aria-label="anchor" href="#hybrid-method"></a>
</h3>
<p>The third method attempts to combine the speed of the First N
Character method with the accuracy of the Longest Common Substring
method. This works by first applying the First N Character method, then
applying the Longest Common Substring method for difficult cases -
either when the edit distance is too large for the First N Character
method to remove notes (such as the chicken chasing example above), or
when the length of the cleaned notes is unusually large. Unusually large
is defined as more than a set number of standard deviations above the
mean clean note length, and is calculated using the extremeid
function.</p>
<p>For this method, a larger dataset may be necessary to demonstrate the
presence of outliers, in terms of note size.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">fnc</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/firstnchar.html">firstnchar</a></span><span class="op">(</span><span class="va">validation_dataset</span>, <span class="st">"notes"</span>, <span class="fl">16</span>, <span class="st">"clean_prints"</span>, <span class="st">"page_count"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fnc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">algorithm</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">#&gt;   clean_prints page_count notes         corrected_notes page_notes edit_distance</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>            1          1  <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>            1          2 <span style="color: #949494;">"</span>discharge f… discharge fire… <span style="color: #949494;">"</span>discharg…             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>            1          3 <span style="color: #949494;">"</span>discharge f… ski mask. no m… <span style="color: #949494;">"</span>\r\n\r\n…             0</span></span></code></pre></div>
<p>Above demonstrates the validation dataset cleaned using the First N
Character method, with a character difference cutoff of 16 (meaning that
up to and including a 15 character difference is acceptable). In order
to determine if there are any extremely long note pages that should be
considered for the Longest Common Substring method, the extremeid
function is applied. Here, extreme values are defined as those that are
larger than 4 standard deviations above the mean page length, based on
algorithm condition (because these resulted in different pages, and thus
different notes).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">extreme_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extremeid.html">extremeid</a></span><span class="op">(</span>dataset<span class="op">=</span><span class="va">fnc</span>, extreme<span class="op">=</span><span class="fl">4</span>, clean_notes<span class="op">=</span><span class="st">"page_notes"</span>, </span>
<span>                             pageid<span class="op">=</span><span class="st">"page_count"</span>, group_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"algorithm"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">extreme_dataset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">extreme_value</span><span class="op">==</span><span class="cn">TRUE</span>, <span class="va">clean_prints</span><span class="op">==</span><span class="fl">39</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>select<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clean_prints"</span>, <span class="st">"page_count"</span>, <span class="st">"notes"</span>, <span class="st">"corrected_notes"</span>, <span class="st">"page_notes"</span>, <span class="st">"extreme_value"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">#&gt;   clean_prints page_count notes         corrected_notes page_notes extreme_value</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>           39         12 <span style="color: #949494;">"</span>In this cas… <span style="color: #949494;">"</span>Q: Is there s… <span style="color: #949494;">"</span>In this … TRUE</span></span></code></pre></div>
<p>The comments that should then be considered using the Longest Common
Substring method are those with an extremely large amount of notes
(extreme_value=TRUE), and those with an edit distance above the cutoff
used in the First N Character method (larger than 15). Note that the
previous page of notes is also necessary for comparison in the Longest
Common Substring method.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">extreme_dataset</span> <span class="op">&lt;-</span> <span class="va">extreme_dataset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>apply_lcs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">edit_distance</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">extreme_value</span><span class="op">==</span><span class="cn">TRUE</span> <span class="op">|</span> <span class="va">edit_distance</span> <span class="op">&gt;</span> <span class="fl">15</span><span class="op">)</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">extreme_dataset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">apply_lcs</span><span class="op">==</span><span class="cn">TRUE</span>, <span class="va">clean_prints</span><span class="op">==</span><span class="fl">39</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>select<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clean_prints"</span>, <span class="st">"page_count"</span>, <span class="st">"notes"</span>, <span class="st">"page_notes"</span>, <span class="st">"apply_lcs"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   clean_prints page_count notes                             page_notes apply_lcs</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>           39         11 <span style="color: #949494;">"</span>In this case, the defendant - R… <span style="color: #949494;">"</span>In this … TRUE</span></span></code></pre></div>
<p>Observations where “apply_lcs” is true indicate those difficult
cases. They can then be run through the hybrid application of lcs to
clean the remaining notes. Due to time, this process was only completed
on a single participant.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">hybrid_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lcsclean_hybrid.html">lcsclean_hybrid</a></span><span class="op">(</span>dataset<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">extreme_dataset</span>, <span class="va">clean_prints</span><span class="op">==</span><span class="fl">39</span><span class="op">)</span>, notes<span class="op">=</span><span class="st">"notes"</span>, propor<span class="op">=</span><span class="fl">0.333</span>, identifier<span class="op">=</span><span class="st">"clean_prints"</span>, pageid<span class="op">=</span><span class="st">"page_count"</span>, toclean<span class="op">=</span><span class="st">"apply_lcs"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hybrid_dataset</span><span class="op">[</span><span class="va">hybrid_dataset</span><span class="op">$</span><span class="va">apply_lcs</span><span class="op">==</span><span class="cn">TRUE</span>,<span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>select<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clean_prints"</span>, <span class="st">"page_count"</span>, <span class="st">"notes"</span>, <span class="st">"page_notes"</span>, <span class="st">"lcs_notes"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   clean_prints page_count notes                             page_notes lcs_notes</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>           39         11 <span style="color: #949494;">"</span>In this case, the defendant - R… <span style="color: #949494;">"</span>In this … A: No. W…</span></span></code></pre></div>
<p>The above notes show the difficult cases for the First N Character
method (indicated as “page_notes”) and the Longest Common Substring
(“lcs_notes”). The hybrid column combines the two methods for the
complete notes.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Center for Statistics and Applications in Forensic Evidence, Rachel Rogers, Susan VanderPlas.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
